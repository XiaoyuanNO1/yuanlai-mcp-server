# 元来如此公司 Agent 集群 MCP Server

## 📖 简介

这是一个为"元来如此"公司打造的 MCP Server，提供统一的子 Agent 调用接口。通过智能意图识别和任务编排，自动调用相应的子 Agent 并汇总结果。

## 🎯 功能特性

### 支持的子 Agent

1. **💰 财务助手**
   - 查询营业收入、利润、负债等财务指标
   - 分析公司经营状况
   - 关键词：财务、收入、利润、负债、现金、经营

2. **👥 人力资源助手**
   - 查询员工信息、职级、薪资
   - 了解团队规模和人员分布
   - 关键词：员工、人力、职级、薪资、入职

3. **🔧 研发助手**
   - 查询项目进度和团队规模
   - 了解技术栈和产品规划
   - 关键词：项目、研发、开发、进度、技术

### 核心能力

- ✅ **智能意图识别**：自动识别问题类型，调用合适的子 Agent
- ✅ **多 Agent 协作**：支持跨领域问题，自动拆解并调用多个子 Agent
- ✅ **统一接口**：提供 4 个标准工具，简化调用流程
- ✅ **范围控制**：超出服务范围的问题会明确拒绝

## 🛠️ 工具列表

### 1. query_finance
查询公司财务数据

**参数**：
- `question` (string): 财务相关问题

**示例**：
```json
{
  "question": "公司现在的营业收入是多少？"
}
```

### 2. query_hr
查询人力资源数据

**参数**：
- `question` (string): 人力资源相关问题

**示例**：
```json
{
  "question": "老张来公司多久了？"
}
```

### 3. query_rd
查询研发项目数据

**参数**：
- `question` (string): 研发项目相关问题

**示例**：
```json
{
  "question": "公司现在在做什么项目？"
}
```

### 4. query_company（推荐）
智能查询公司信息，自动识别并调用相应的子 Agent

**参数**：
- `question` (string): 关于公司的任何问题

**示例**：
```json
{
  "question": "公司整体情况怎么样？"
}
```

**特点**：
- 自动识别问题涉及的领域
- 支持单一领域问题（如"公司负债多少"）
- 支持跨领域问题（如"公司整体情况"会同时查询财务、人力、研发）
- 超出范围的问题会返回友好提示

## 📦 安装与部署

### 依赖要求

```bash
pip install requests mcp
```

### 本地测试

```bash
python3 yuanlai_mcp_server.py
```

### 在 Knot 平台部署

1. **登录 Knot 平台**：访问 https://knot.woa.com

2. **创建 MCP Server**：
   - 进入"MCP 管理"页面
   - 点击"新建 MCP Server"
   - 上传 `yuanlai_mcp_server.py` 和 `yuanlai_mcp_config.json`

3. **配置 Agent**：
   - 在你的 Agent 中启用该 MCP Server
   - 系统会自动识别 4 个工具

4. **开始使用**：
   - 在企微对话中直接提问
   - Agent 会自动调用 MCP 工具获取信息

## 🎮 使用示例

### 单一领域查询

**用户**："老李的职级是多少？"

**处理流程**：
1. 识别为人力资源问题
2. 调用 `query_hr` 工具
3. 返回老李的职级和薪资信息

---

**用户**："公司有什么负债吗？"

**处理流程**：
1. 识别为财务问题
2. 调用 `query_finance` 工具
3. 返回公司负债情况

---

### 跨领域查询

**用户**："公司现在经营情况怎么样？在做什么项目？"

**处理流程**：
1. 识别为财务 + 研发问题
2. 并行调用 `query_finance` 和 `query_rd`
3. 汇总两个 Agent 的回复
4. 返回综合报告

---

**用户**："公司整体情况怎么样？"

**处理流程**：
1. 识别为综合性问题
2. 调用所有三个子 Agent（财务、人力、研发）
3. 汇总信息
4. 返回全面的公司情况报告

---

### 超出范围

**用户**："今天天气怎么样？"

**返回**："这个问题超出了 Agent 的服务范围，咱们换个问题吧"

## 🔧 自定义配置

### 添加新的子 Agent

编辑 `yuanlai_mcp_server.py`，在 `SUB_AGENTS` 字典中添加新配置：

```python
SUB_AGENTS = {
    # ... 现有配置 ...
    "new_agent": {
        "name": "新助手",
        "app_key": "你的 AppKey",
        "description": "负责 XXX 查询",
        "keywords": ["关键词1", "关键词2"]
    }
}
```

### 调整意图识别逻辑

修改 `identify_agents()` 函数，自定义关键词匹配规则。

## 📊 技术架构

```
用户问题
    ↓
[意图识别]
    ↓
[任务拆解]
    ↓
[并行调用子 Agent]
    ↓
[结果汇总]
    ↓
返回给用户
```

## 🚀 优势

1. **即插即用**：在 Knot 平台配置后，所有对话都能使用
2. **智能路由**：自动识别问题类型，无需手动指定
3. **可扩展**：轻松添加新的子 Agent
4. **统一管理**：所有子 Agent 配置集中管理
5. **企微集成**：完美支持企业微信对话场景

## 📝 注意事项

1. **API 超时**：默认超时 60 秒，可根据实际情况调整
2. **关键词匹配**：意图识别基于关键词，复杂问题可能需要优化
3. **并发调用**：多个子 Agent 是串行调用，未来可优化为并发
4. **错误处理**：所有错误都会返回友好的提示信息

## 📞 联系方式

如有问题或建议，请联系 Neil

---

**版本**：1.0.0  
**更新时间**：2026-02-11  
**许可证**：MIT
